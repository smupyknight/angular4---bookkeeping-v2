<div data-ng-controller="NewInvoiceCtrl" class="robust-content container center-layout mt-2">
  <div class="content-wrapper">
    <div class="content-header row">
      <div class="content-header-left col-md-9 col-xs-12">
        <h2 class="content-header-title mb-0">Invoice No# {{ transaction.transaction.invoice_receipt_no }} </h2>
        <div class="row breadcrumbs-top">
          <div class="breadcrumb-wrapper col-xs-12">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#/dashboard">Home</a></li>
              <li class="breadcrumb-item"><a href="#/sales">Sales</a></li>
              <li class="breadcrumb-item active">Invoice
              </li>
            </ol>
          </div>
        </div>
      </div>
      <div class="content-header-right text-md-right col-md-3 col-xs-12">
        <div class="dropdown" style="width: 150px; float: right;">
          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown"> New Transaction </button>
          <div class="dropdown-menu">
            <a class="dropdown-item" href="#/new-invoice"> New Invoice </a>
            <a class="dropdown-item" href="#/new-payment"> New Payment </a>
            <a class="dropdown-item" href="#/new-sales-receipt"> Sales Receipt </a>
          </div>
        </div>
      </div>

      <div class="modal fade text-xs-left" id="newPersonDialog" tabindex="-1" role="dialog" data-labelledby="myModalLabel1" aria-hidden="true" data-sej-person-dialog data-create-event="createPerson"> </div>

      <div class="modal fade text-xs-left" id="productServiceDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true" data-sej-product-service-dialog data-create-event="createProductService"> </div>

      <div class="modal fade text-xs-left" id="productCategoryDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true" data-sej-product-category-dialog data-create-event="createProductCategory" data-update-event="updateProductCategory"> </div>

      <div class="modal fade text-xs-left" id="deleteConfirmDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true" data-sej-delete-confirm-dialog data-delete-event="deleteTransaction" data-target-name="invoice"> </div>

      <p class="m-0">&nbsp;</p>
    </div>

    <div class="content-body">
      <section>
        <div class="row">
          <div class="col-xs-12">
            <form class="form form-horizontal form-add-new-invoice" novalidate>
              <div class="card">
                  <div class="card-header dateH" style="display: inline-block;">
                    <div class="col-md-4 mbv-1 hidden">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Transaction Type</p>
                        <input type="text" class="form-control" data-ng-model="transactionType" data-ng-init="transactionType='invoice'"/>
                      </div>
                    </div>
                    <div class="col-md-4 offset-md-4 mbv-1 text-md-right hidden">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Transaction Type</p>
                        <input type="text" tabindex="2" class="form-control" data-ng-model="transaction.transaction.transaction_type" data-ng-init="transaction.transaction.transaction_type=1"/>
                      </div>
                    </div>
                    <div class="col-md-4 mbv-1 hidden">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Table Name</p>
                        <input type="text" class="form-control" data-ng-model="targetTableName" data-ng-init="targetTableName='customer'"/>
                      </div>
                    </div>
                    <div class="form-group row has-feedback hidden">
                      <label class="col-md-3 label-control"> Person Type </label>
                      <input class="form-control hidden" data-ng-model="personListType" data-ng-init="personListType='customer'" placeholder="Name" type="text" tabindex="1">
                    </div>
                    <div class="col-md-4 mbv-1">
                      <div>
                        <select id="customerDropdown" data-ng-model="transaction.transaction.customer" placeholder="Select a person..." data-ng-options="customer as 'Customer' for customer in customerNames track by customer" add-new-dropdown data-add-new-event="selectPersonType" data-customer-supplier-dropdown>
                        </select>
                        <div id="selectPersonType" class="slt-open-dd card" sej-person-type-dialog> </div>
                      </div>
                    </div>
                    <div class="col-md-4 mbv-1 hidden">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Status</p>
                        <input type="text" class="form-control" data-ng-model="transaction.transaction.status" data-ng-init="transaction.transaction.status=1"/>
                      </div>
                    </div>
                    <div class="col-md-4 mbv-1 from_date">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Invoice</p>
                        <span class="input-group-addon"><i class="icon-calendar3"></i></span>
                        <input type="text" class="form-control dp-month-year" data-ng-model="transaction.transaction.date"/>
                        <div class="help-block font-small-3"></div>
                      </div>
                    </div>
                    <div class="col-md-4 mbv-1 to_date">
                      <div class="input-group">
                        <p class="inpt-grp-addon">Due&nbsp;Date</p>
                        <span class="input-group-addon"><i class="icon-calendar3"></i></span>
                        <input type="text" class="form-control dp-month-year" data-ng-model="transaction.transaction.due_date"/>
                      </div>
                    </div>
                  </div>
                  <div class="card-body" id="base-style" style="display: inline-block;">
                    <div class="card-block card-dashboard">
                      <table class="table table-bordered tbl-invc table-responsive" id="invoiceItems">
                        <thead>
                          <tr>
                            <th width="5%">&nbsp;</th>
                            <th width="5%" align="center">#</th>
                            <th width="20%">Product/Service</th>
                            <th width="20%">Description</th>
                            <th width="12%">QTY</th>
                            <th width="12%">Rate</th>
                            <th width="12%">Amount</th>
                            <th width="5%">&nbsp;</th>
                          </tr>
                        </thead>
                        <tbody>
                          <form class="form form-validation form-invoice-items" novalidate>
                            <tr data-ng-repeat="invoiceItem in transaction.invoiceItems" data-ng-if="invoiceItem.rank">
                              <td> <button class="btn btn-link"> <i class="icon-hand-grab-o"> </i> </button> </td>
                              <td align="center"> {{ invoiceItem.rank }} </td>
                              <td> <select data-ng-if="invoiceItem.item_type==1" placeholder="Select a product/service..." data-ng-model="invoiceItem.product_service" data-ng-options="product as product for product in productServiceNames track by product" data-add-new-dropdown data-add-new-event="showCreateProductServiceDialog" data-ng-change="setProductServiceRate( invoiceItem.product_service, productServices, invoiceItem )">
                              </select> </td>
                              <td> <textarea data-ng-if="invoiceItem.item_type==1" class="form-control" data-ng-model="invoiceItem.description"> </textarea> </td>
                              <td> <input data-ng-if="invoiceItem.item_type==1" class="form-control" type="number" data-ng-change="calculateAmount( invoiceItem, transaction.invoiceItems )" data-ng-model="invoiceItem.qty" step="1" decimal-point required> </td>
                              <td> <input data-ng-if="invoiceItem.item_type==1" class="form-control decimal" type="number" data-ng-change="calculateAmount( invoiceItem, transaction.invoiceItems )" data-ng-model="invoiceItem.rate" data-ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" decimal-point required> </td>
                              <td> 
                                <input data-ng-if="invoiceItem.item_type==1" class="form-control" type="number" data-ng-model="invoiceItem.amount" data-ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" required> 
                                <span data-ng-if="invoiceItem.item_type==2"> Subtotal: {{ invoiceItem.amount }} </span>
                              </td>
                              <td algin="center"> <button class="btn btn-icon btn-sm btn-link text-danger" data-ng-click="removeLine(transaction.invoiceItems, {{ invoiceItem.removeIndex }})"> <i class="icon-trash-o"> </i> </button> </td>
                            </tr>
                          </form>
                        </tbody>
                      </table>

                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group btng mb-1">
                            <button class="btn btn-outline-primary mr-1 mb-1" data-ng-click="addLines(transaction.invoiceItems, newInvoiceItem)">Add Lines</button>
                            <button class="btn btn-outline-primary mr-1 mb-1" data-ng-click="clearAllLines(transaction.invoiceItems, newInvoiceItem)">Clear All Lines</button>
                            <button class="btn btn-outline-primary mr-1 mb-1" data-ng-click="addSubTotal( transaction.invoiceItems )">Add Sub Total</button>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-7">
                          <div class="row form-group">
                            <div class="col-md-6 form-group"><label>Message displayed on invoice</label><textarea class="form-control" data-ng-model="transaction.invoice.message"></textarea></div>
                            <div class="col-md-6"><label>Statement memo</label><textarea class="form-control" data-ng-model="transaction.invoice.statement_memo"></textarea></div>
                            <div class="col-md-12">
                              <div class="drag-drop-file">
                                <form action="#/" class="dropzone" id="dpz-single-file"></form>
                              </div>
                            </div>
                          </div>

                        </div>
                        <div class="col-md-5 mb-1">
                          <div class="form-group">
                            <table class="table tbl-invc">
                              <tr>
                                <td width="50%" class="bdrT-none">
                                  <label>&nbsp;</label>
                                    <select class="form-control" data-ng-model="transaction.invoice.discount_type_id" data-ng-change="calculateDiscount()" data-ng-init="invoice.invoice.discount_type_id='3'">
                                      <option value="1">Discount percent</option>
                                      <option value="2">Discount value</option>
                                      <option value="3">No discount</option>
                                    </select>
                                </td>
                                <td width="30%" class="bdrT-none">
                                  <label>Sub Total</label>
                                  <input type="text" data-ng-if="transaction.invoice.discount_type!='No discount'" class="form-control" data-ng-model="transaction.invoice.discount_amount" data-ng-change="calculateDiscount()">
                                  <input type="text" class="form-control hidden" data-ng-model="transaction.invoice.sub_total">
                                </td>
                                <td width="20%" align="right" class="bdrT-none">
                                  <p>{{ transaction.invoice.sub_total | currency }}</p>
                                  <p>{{ discountValue | currency }}</p>
                                </td>
                              </tr>
                              <tr>
                                <td>&nbsp;</td>
                                <td>Shipping</td>
                                <td align="right"><input type="text" class="form-control" data-ng-model="transaction.invoice.shipping" data-ng-change="calculateTotal()"></td>
                              </tr>
                              <tr>
                                <td>&nbsp;</td>
                                <td>Total</td>
                                <td align="right"><p>{{ transaction.transaction.total | currency }}</p><input type="hidden" class="form-control" data-ng-model="transaction.transaction.total"></td>
                              </tr>
                              <tr>
                                <td>&nbsp;</td>
                                <td>Deposit</td>
                                <td align="right"><input type="text" class="form-control" data-ng-model="transaction.invoice.deposit" data-ng-change="calculateTotal()"></td>
                              </tr>
                              <tr>
                                <td>&nbsp;</td>
                                <td>Balance Due</td>
                                <td align="right"><p>{{ transaction.balanceDue | currency }}</p></td>
                              </tr>
                            </table>
                          </div>
                          <fieldset class="form-group has-feedback">
                            <div class="help-block font-small-3 errors" data-ng-repeat="errorMessage in errorMessages"> {{ errorMessage }} </div>
                          </fieldset>
                        </div>
                      </div>
                      <div class="row form-group">
                        <div class="col-md-12 text-md-right btn-rgt-grp">
                          <button class="btn btn-secondary mr-1 mb-1" data-ng-click="showDeleteTransactionDialog()">Delete</button>
                          <button class="btn btn-secondary mr-1 mb-1" data-ng-click="print()">Print</button>
                          <button class="btn btn-secondary mr-1 mb-1" data-ng-click="clearAll()">Clear</button>
                          <button class="btn btn-primary mr-1 mb-1" data-ng-click="createOrUpdate(false)">Save & Close</input>
                          <button class="btn btn-primary mb-1" data-ng-click="createOrUpdate(true)">Save & New</input>
                        </div>
                      </div>
                    </div>
                  </div>
              </div>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>